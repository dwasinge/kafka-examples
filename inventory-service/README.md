# Inventory Service

## Overview

The inventory service uses [Quarkus](https://quarkus.io) and is used to manage inventory resources. An inventory resource defines the current quantity of an item for a given store.  It exposes a REST API that provides endpoints to retrieve, create/update inventory resources.

### Data Store

The service is configured to use [Mongo](https://www.mongodb.com/) as its data store.

### Events and Kafka Topics

The inventory service manages several events and topics.

#### Consumer

The inventory service is a consumer of the following topics:
* `store-events` - processes StoreEvent to add new stores to the inventory data store along with initializing items for the store
* `item-events` - processes ItemEvent to add new items to the existing stores inventory
* `inventory-events` - processes InventoryEvent to increment or decrement item counts for a given store

#### Producer

The inventory service is producer to the following topics:
* `low-inventory-events` - publishes a LowInventoryEvent to the topic if the current quantity of an item is lower than the defined threshold

## How do I use it?

### Prerequisites

* Java 8
* Apache Maven
* Docker (if using for Mongo)
* A running Mongo instance

#### Starting Mongo using Docker

Assuming docker is installed, run the following command:
```
docker run --name inventory-mongo -p 27017:27017 -d mongo
```

NOTE: The store mongo instance can also be used if that is already started and running.

### Running the application in dev mode

You can run your application in dev mode that enables live coding using:
```
./mvnw quarkus:dev
```

### Packaging and running the application

The application is packageable using `./mvnw package`.
It produces the executable `inventory-service-1.0-SNAPSHOT-runner.jar` file in `/target` directory.
Be aware that it’s not an _über-jar_ as the dependencies are copied into the `target/lib` directory.

The application is now runnable using `java -jar target/inventory-service-1.0-SNAPSHOT-runner.jar`.

### Creating a native executable

You can create a native executable using: `./mvnw package -Pnative`.

Or you can use Docker to build the native executable using: `./mvnw package -Pnative -Dquarkus.native.container-build=true`.

You can then execute your binary: `./target/inventory-service-1.0-SNAPSHOT-runner`

If you want to learn more about building native executables, please consult https://quarkus.io/guides/building-native-image-guide .

## Access the application

To access the application, open the following link in your browser:

`http://localhost:8080`

Swagger UI can be accessed with the following link:

`http://localhost:8080/swagger-ui/`

### Exposed Endpoints

All exposed endpoints and Models can be found using the [swagger api documentation](http://localhost:8080/openapi) or the [swagger-ui page](http://localhost:8080/swagger-ui/).

The current endpoints are as follows:
```
# retrieve all inventory resources
GET    /inventory

# retrieve all inventory resource for a given store ID
GET    /inventory/stores/{storeId}

# retrieve the inventory resource for a given store ID and item ID
GET    /inventory/stores/{storeId}/items/{itemId-}

# create or update an inventory resource
POST   /inventory

# create or update multiple inventory resources from a list
POST   /inventory

```

### Store Resource Model
```
InventoryDetail:
{
id              ObjectId{...}
currentQuantity integer($int32)
itemId          integer($int32)
storeId         integer($int32)
}
```

NOTE: ObjectId is generated by Mongo upon creation

### Other Processes

There is currently a scheduled process that will periodically check the current quantity of an item at a store and if it is below the configured threshold, generate a `low-inventory-event` and publish to the `low-inventory-events` topic to be consumed by the order service.

Currently Unimplemented -
* Need to consume store events and create new inventory resources for each item in the store
* Need to consume item events and create the item for all stores currently configured
